<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Build a Fraction</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* ===== animations ===== */
    .fade{animation:fade .25s ease-out both;opacity:0;transform:translateY(-6px)}
    @keyframes fade{to{opacity:1;transform:translateY(0)}}

    /* ===== fraction typography ===== */
    .fraction{display:inline-flex;flex-direction:column;align-items:center;line-height:1}
    .fraction .top,.fraction .bottom,.whole{font-size:1.5em;font-weight:600;color:#0f172a}
    .fraction .line{width:100%;height:2px;background:#0f172a;margin:2px 0}

    /* NEW: keep whole centred beside the fraction */
    .mixed{display:inline-flex;align-items:center;gap:.15em}
    .mixed .whole{font-size:1.5em;font-weight:600;color:#0f172a}

    /* ===== builder look ===== */
    #builder,.wholeBar{width:420px;height:60px;display:flex;border:3px solid #334155;border-radius:.75rem;overflow:hidden;background:#f8fafc;box-shadow:0 3px 7px rgba(0,0,0,.15)}
    .cell{flex:1 1 0;display:flex;align-items:center;justify-content:center;border-right:1px solid #94a3b8;cursor:pointer;transition:background .15s}
    .cell:last-child{border-right:none}
    .cell:not(.filled):hover{background:#e2e8f0}
    .cell.filled{background:#facc15}

    /* ===== cute buttons ===== */
    .btnStd{border-2 border-slate-800 rounded-md w-10 h-10 flex items-center justify-content-center text-2xl bg-white hover:bg-slate-100 active:translate-y-px shadow transition}
  </style>
</head>
<body class="min-h-screen flex flex-col items-center gap-6 bg-gradient-to-br from-sky-100 to-indigo-100 select-none p-4 font-[system-ui]">

<!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ overlay menu ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<div id="overlay" class="fixed inset-0 bg-black/70 flex items-center justify-center z-50">
  <div class="bg-white rounded-xl shadow-2xl p-6 w-[92%] max-w-sm flex flex-col gap-4 fade">
    <h2 class="text-2xl font-bold text-center mb-2">Start Fraction Challenge</h2>

    <label class="font-semibold">Name</label>
    <input id="nameInput" type="text" placeholder="Enter your name" class="border rounded px-3 py-2" />

    <label class="font-semibold mt-2">Mode</label>
    <label class="flex items-center gap-2"><input type="radio" name="mode" value="timed" checked /> Timed</label>
    <label class="flex items-center gap-2"><input type="radio" name="mode" value="target" /> Target score</label>

    <!-- timer lengths -->
    <div id="timerGroup" class="flex flex-col gap-1 pl-4">
      <label class="flex items-center gap-2"><input type="radio" name="timer" value="60" checked/> 1&nbsp;min</label>
      <label class="flex items-center gap-2"><input type="radio" name="timer" value="180"/> 3&nbsp;min</label>
      <label class="flex items-center gap-2"><input type="radio" name="timer" value="300"/> 5&nbsp;min</label>
      <label class="flex items-center gap-2"><input type="radio" name="timer" value="none"/> No limit</label>
    </div>

    <!-- target-score input -->
    <div id="targetGroup" class="hidden flex flex-col gap-2 pl-4">
      <label class="font-semibold" for="goalInput">Target score</label>
      <input id="goalInput" type="number" min="1" placeholder="e.g. 15" class="border rounded px-3 py-2" />
    </div>

    <button id="startBtn" class="mt-2 bg-emerald-600 hover:bg-emerald-700 text-white font-semibold rounded px-4 py-2">Start</button>
  </div>
</div>

<!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ header + HUD ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<h1 class="text-4xl md:text-5xl font-extrabold drop-shadow-sm">Build a Fraction</h1>
<div class="flex flex-wrap gap-6 justify-center text-xl font-semibold">
  <div>üë§ <span id="playerName">‚Äî</span></div>
  <div>üèÜ Score <span id="score">0</span>/<span id="total">0</span></div>
  <div id="goalBox" class="hidden">üéØ Goal <span id="goal">‚Äî</span></div>
  <div>‚è± <span id="timer">--:--</span></div>
</div>

<!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ target fraction ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<p class="text-2xl mt-2">Target: <span id="targetBox" class="inline-block border-4 border-emerald-600 bg-white rounded-lg px-4 py-1 shadow-lg"><span id="target"></span></span></p>

<!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ controls + builder ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<div id="builderWrap" class="flex flex-col items-center gap-6 w-full max-w-xl fade">
  <!-- denominator controls -->
  <div class="flex items-center gap-4 text-xl font-semibold">
    <button id="decDenom" class="btnStd">‚Äì</button>
    <span>Denominator <span id="denomLabel">2</span></span>
    <button id="incDenom" class="btnStd">+</button>
  </div>

  <!-- whole number controls -->
  <div class="flex items-center gap-4 text-xl font-semibold">
    <button id="addWhole" class="btnStd">+1</button>
    <button id="remWhole" class="btnStd">‚Äì1</button>
    <span>Wholes <span id="wholeLabel">0</span>/2</span>
  </div>

  <!-- bars -->
  <div id="wholeWrap" class="flex flex-col gap-2"></div>
  <div id="builder"></div>

  <button id="checkBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white px-7 py-2 rounded-full shadow-lg text-lg tracking-wide">Check</button>
  <p id="feedback" class="text-2xl h-8 font-semibold"></p>
</div>

<script>
/****************** helpers ******************/
const $ = id=>document.getElementById(id);
const rnd=(min,max)=>Math.floor(Math.random()*(max-min+1))+min;
const fmtTime=s=>s===null?'‚àû':`${Math.floor(s/60)}:${String(s%60).padStart(2,'0')}`;

/****************** constants ******************/
const MIN_D=2,MAX_D=10,MAX_WHOLE=2;

/****************** state ******************/
let denom=2;
let wholeCnt=0;
let target=null;
let score=0,total=0;
let tLeft=null,tInt=null;
let mode='timed';
let goal=null;

/****************** fraction utils ******************/
function randTarget(){
  let w,n,d;
  do{ w=rnd(0,MAX_WHOLE); d=rnd(MIN_D,MAX_D); n=rnd(0,d-1); }while(w===0&&n===0);
  return {w,n,d};
}

/* ------------- FIXED: neat mixed-number layout ------------- */
function fracHTML({w,n,d}){
  const frac=n?`
      <span class="fraction">
        <span class="top">${n}</span>
        <span class="line"></span>
        <span class="bottom">${d}</span>
      </span>`:'';

  if(w){      /* mixed or whole */
    if(n===0){ // a pure whole number  (rare here, but handle)
      return `<span class="mixed"><span class="whole">${w}</span></span>`;
    }
    return `
      <span class="mixed">
        <span class="whole">${w}</span>
        ${frac}
      </span>`;
  }
  return frac; /* proper fraction */
}

/****************** builder logic ******************/
function buildBuilder(){
  const builder=$('builder');
  builder.innerHTML='';
  for(let i=0;i<denom;i++){
    const c=document.createElement('div');
    c.className='cell';
    c.onclick=()=>{c.classList.toggle('filled');};
    builder.appendChild(c);
  }
  $('denomLabel').textContent=denom;
  buildWholeBars();
}
function buildWholeBars(){
  const wrap=$('wholeWrap');
  wrap.innerHTML='';
  for(let r=0;r<wholeCnt;r++){
    const row=document.createElement('div');
    row.className='wholeBar';
    for(let i=0;i<denom;i++){
      const c=document.createElement('div');
      c.className='cell filled';
      row.appendChild(c);
    }
    wrap.appendChild(row);
  }
  $('wholeLabel').textContent=wholeCnt;
}
function countFilled(){
  return $('builder').querySelectorAll('.cell.filled').length;
}

/****************** HUD helpers ******************/
function updateScore(){
  $('score').textContent=score;
  $('total').textContent=total;
}
function showGoal(){
  if(goal!==null){ $('goal').textContent=goal; $('goalBox').classList.remove('hidden'); }
  else $('goalBox').classList.add('hidden');
}

/****************** game flow ******************/
function newRound(){
  target=randTarget();
  $('target').innerHTML=fracHTML(target);
  denom=2;wholeCnt=0;
  buildBuilder();
  total++;updateScore();
  $('feedback').textContent='';
}
function checkAnswer(){
  const filled=countFilled();
  if(filled===0 && wholeCnt===0){alert('Add wholes or colour cells!');return;}
  const lhs=(wholeCnt*denom+filled)*target.d;
  const rhs=(target.w*target.d+target.n)*denom;
  if(lhs===rhs){
    score++; $('feedback').textContent='‚úÖ Great!'; $('feedback').style.color='#16a34a';
    if(mode==='target' && score>=goal){
      setTimeout(()=>{alert(`üéâ Goal reached! Score ${score}/${total}`); location.reload();},600);
      return;
    }
    setTimeout(newRound,700);
  }else{
    $('feedback').textContent='‚ùå Try again‚Ä¶'; $('feedback').style.color='#dc2626';
  }
  updateScore();
}

/****************** timer ******************/
function startTimer(){
  clearInterval(tInt);
  if(tLeft===null){$('timer').textContent='‚àû';return;}
  $('timer').textContent=fmtTime(tLeft);
  tInt=setInterval(()=>{
    if(--tLeft<0){clearInterval(tInt);alert(`Time's up! Final ${score}/${total}`);location.reload();}
    else $('timer').textContent=fmtTime(tLeft);
  },1000);
}

/****************** overlay behaviour ******************/
function toggleGroups(){
  mode=document.querySelector('input[name="mode"]:checked').value;
  $('timerGroup').classList.toggle('hidden',mode!=='timed');
  $('targetGroup').classList.toggle('hidden',mode!=='target');
}
document.querySelectorAll('input[name="mode"]').forEach(r=>r.onchange=toggleGroups);

toggleGroups();

$('startBtn').onclick=()=>{
  $('playerName').textContent=$('nameInput').value.trim()||'Player';
  mode=document.querySelector('input[name="mode"]:checked').value;
  if(mode==='timed'){
    const val=document.querySelector('input[name="timer"]:checked').value;
    tLeft=val==='none'?null:+val;
    goal=null;
  }else{
    tLeft=null;
    goal=parseInt($('goalInput').value,10);
    if(isNaN(goal)||goal<1){alert('Enter a positive target score');return;}
  }
  showGoal();
  startTimer();
  $('overlay').style.display='none';
  newRound();
};

/****************** button wiring ******************/
$('incDenom').onclick=()=>{if(denom<MAX_D){denom++;buildBuilder();}};
$('decDenom').onclick=()=>{if(denom>MIN_D){denom--;buildBuilder();}};
$('addWhole').onclick=()=>{if(wholeCnt<MAX_WHOLE){wholeCnt++;buildWholeBars();}};
$('remWhole').onclick=()=>{if(wholeCnt>0){wholeCnt--;buildWholeBars();}};
$('checkBtn').onclick=checkAnswer;
</script>
</body>
</html>
